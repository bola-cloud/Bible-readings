import json
import os
import re
from datetime import datetime, timedelta

schedule = {
    # January
    "01-01-2026": "(لوقا 1/ 5- 25)",
    "02-01-2026": "(لوقا 1/ 26- 38)",
    "03-01-2026": "(لوقا 1/ 39- 45)",
    "04-01-2026": "(لوقا 1/ 46- 56)",
    "05-01-2026": "(لوقا 1/ 57- 66)",
    "06-01-2026": "(لوقا 1/ 67- 80)",
    "07-01-2026": "(لوقا 2/ 1- 7)",
    "08-01-2026": "(متى 1/ 18- 25)",
    "09-01-2026": "(لوقا 2/ 8- 20)",
    "10-01-2026": "(إشعياء 7/ 1- 16)",
    "11-01-2026": "(إشعياء 9/ 1- 7)",
    "12-01-2026": "(إشعياء 11/ 1- 10)",
    "13-01-2026": "(لوقا 2/ 21- 40)",
    "14-01-2026": "(لوقا 2/ 41- 52)",
    "15-01-2026": "(متى 2/ 1- 12)",
    "16-01-2026": "(متى 2/ 13- 18)",
    "17-01-2026": "(متى 2/ 19- 23)",
    "18-01-2026": "(فيليبي 2/ 1- 11)",
    "19-01-2026": "(يوحنا 1/ 1- 18)",
    "20-01-2026": "(يوحنا 1/ 19- 28)",
    "21-01-2026": "(متى 3/ 1- 12)",
    "22-01-2026": "(متى 3/ 13- 17)",
    "23-01-2026": "(مرقس 1/ 9- 11)",
    "24-01-2026": "(لوقا 3/ 1- 14)",
    "25-01-2026": "(لوقا 3/ 1- 14)",
    "26-01-2026": "(غلاطية 3/ 26- 4/7)",
    "27-01-2026": "(أفسس 4/ 1- 6)",
    "28-01-2026": "(كولوسي 2/ 6- 15)",
    "29-01-2026": "(بطرس الأولى 3/ 8- 22)",
    "30-01-2026": "(أعمال 8/ 26- 40)",
    "31-01-2026": "(يوحنا 3/ 1- 21)",

    # February
    "01-02-2026": "(يونان 1/ 1- 17)",
    "02-02-2026": "(يونان 2/ 1- 10)",
    "03-02-2026": "(يونان 3/ 1- 10)",
    "04-02-2026": "(يونان 4/ 1- 11)",
    "05-02-2026": "(متى 12/ 38- 42)",
    "06-02-2026": "(مزامير 130)",
    "07-02-2026": "(لوقا 10/ 25- 37)",
    "08-02-2026": "(يوحنا الأولى 1/ 5- 10)",
    "09-02-2026": "(يهوذا 1/ 17- 24)",
    "10-02-2026": "(كورنثوس الأولى 12/ 12- 31)",
    "11-02-2026": "(مزامير 103)",
    "12-02-2026": "(لوقا 18/ 9- 14)",
    "13-02-2026": "(متى 13/ 54- 58)",
    "14-02-2026": "(مزامير 34)",
    "15-02-2026": "(رؤيا 2/ 1- 7)",
    "16-02-2026": "(تكوين 3/ 1-7)",
    "17-02-2026": "(تكوين 3/ 8- 19)",
    "18-02-2026": "(تكوين 39/ 1- 23)",
    "19-02-2026": "(يشوع 2/ 1- 24)",
    "20-02-2026": "(أمثال 3/ 1- 12)",
    "21-02-2026": "(أعمال 5/ 1- 11)",
    "22-02-2026": "(رومية 2/ 1- 16)",
    "23-02-2026": "(كورنثوس الأولى 1/ 18- 31)",
    "24-02-2026": "(رومية 3/ 9- 20)",
    "25-02-2026": "(قضاة 16/ 1- 22)",
    "26-02-2026": "(أعمال 13/ 4- 12)",
    "27-02-2026": "(كورنثوس الثانية 5/ 11- 21)",
    "28-02-2026": "(إرميا 18/ 1- 10)",

    # March
    "01-03-2026": "(متى 6/ 1-4)",
    "02-03-2026": "(متى 6/ 5-8)",
    "03-03-2026": "(متى 6/ 9-15)",
    "04-03-2026": "(متى 6/ 16-18)",
    "05-03-2026": "(إشعياء 58/ 1-7)",
    "06-03-2026": "(إشعياء 58/ 8-12)",
    "07-03-2026": "(لوقا 4/ 1-13)",
    "08-03-2026": "(غلاطية 6/ 1-10)",
    "09-03-2026": "(نحميا 1/ 1-11)",
    "10-03-2026": "(متى 5/ 43-48)",
    "11-03-2026": "(مزامير 67)",
    "12-03-2026": "(دانيال 9/ 1-19)",
    "13-03-2026": "(تسالونيكي الأولى 5/ 12-28)",
    "14-03-2026": "(متى 25/ 31-46)",
    "15-03-2026": "(ملوك الأول 19/ 1-18)",
    "16-03-2026": "(تثنية 15/ 7-11)",
    "17-03-2026": "(لوقا 18/ 1-8)",
    "18-03-2026": "(يشوع 24/ 14-15)",
    "19-03-2026": "(مزامير 23)",
    "20-03-2026": "(متى 6/ 24-34)",
    "21-03-2026": "(أعمال 4/ 23-31)",
    "22-03-2026": "(يعقوب 5/ 1-6)",
    "23-03-2026": "(صموئيل الأول 1/ 9-20)",
    "24-03-2026": "(أعمال 16/ 16-40)",
    "25-03-2026": "(كورنثوس الثانية 8/ 1-15)",
    "26-03-2026": "(كورنثوس الثانية 9/ 1-15)",
    "27-03-2026": "(لوقا 16/ 19-31)",
    "28-03-2026": "(أعمال 4/ 32-37)",
    "29-03-2026": "(رؤيا 2/ 8-11)",
    "30-03-2026": "(يعقوب 5/ 13-20)",
    "31-03-2026": "(يوحنا الأولى 2/ 15-17)",

    # April
    "01-04-2026": "(مزامير 1)",
    "02-04-2026": "(مرقس 11/ 1-11)",
    "03-04-2026": "(لوقا 19/ 28-40)",
    "04-04-2026": "(يوحنا 12/ 12-19)",
    "05-04-2026": "(متى 21/ 1-11)",
    "06-04-2026": "(متى 21/ 12-17)",
    "07-04-2026": "(مرقس 11/ 15-19)",
    "08-04-2026": "(متى 26/ 6-13)",
    "09-04-2026": "(لوقا 22/ 7-13)",
    "10-04-2026": "(مرقس 15/ 33-41)",
    "11-04-2026": "(متى 27/ 57-61)",
    "12-04-2026": "(متى 28/ 1-10)",
    "13-04-2026": "(مرقس 16/ 1-8)",
    "14-04-2026": "(يوحنا 20/ 11-18)",
    "15-04-2026": "(لوقا 24/ 13-35)",
    "16-04-2026": "(لوقا 24/ 36-43)",
    "17-04-2026": "(إشعياء 53/ 8-12)",
    "18-04-2026": "(تسالونيكي الأولى 4/ 13-18)",
    "19-04-2026": "(لوقا 18/ 18-28)",
    "20-04-2026": "(يوحنا 2/ 1-11)",
    "21-04-2026": "(يوحنا 5/ 1-15)",
    "22-04-2026": "(مزامير 16)",
    "23-04-2026": "(كورنثوس الأولى 15/ 1-11)",
    "24-04-2026": "(كورنثوس الأولى 15/ 12-34)",
    "25-04-2026": "(كورنثوس الأولى 15/ 35-58)",
    "26-04-2026": "(أفسس 1/ 15-23)",
    "27-04-2026": "(مزامير 22)",
    "28-04-2026": "(فيليبي 3/ 7-16)",
    "29-04-2026": "(تيموثاوس الثانية 2/ 1-13)",
    "30-04-2026": "(يوحنا الأولى 1/ 1-4)",

    # May
    "01-05-2026": "(متى 28/ 16-20)",
    "02-05-2026": "(مرقس 16/ 9-20)",
    "03-05-2026": "(يوحنا 14/ 1-14)",
    "04-05-2026": "(يوحنا 14/ 15-31)",
    "05-05-2026": "(يوحنا 16/ 5-16)",
    "06-05-2026": "(يوحنا 16/ 17-33)",
    "07-05-2026": "(يوحنا 20/ 1-10)",
    "08-05-2026": "(يوحنا 20/ 19-23)",
    "09-05-2026": "(يوحنا 20/ 24-31)",
    "10-05-2026": "(يوحنا 21/ 1-14)",
    "11-05-2026": "(يوحنا 21/ 15-25)",
    "12-05-2026": "(أعمال 1/ 1-14)",
    "13-05-2026": "(أعمال 1/ 15-26)",
    "14-05-2026": "(أعمال 2/ 1-13)",
    "15-05-2026": "(أعمال 3/ 1-10)",
    "16-05-2026": "(أعمال 7/ 54-60)",
    "17-05-2026": "(مزامير 104)",
    "18-05-2026": "(رومية 8/ 1-17)",
    "19-05-2026": "(إشعياء 61/ 1-3)",
    "20-05-2026": "(رومية 8/ 31-39)",
    "21-05-2026": "(غلاطية 5/ 1-15)",
    "22-05-2026": "(غلاطية 5/ 16-26)",
    "23-05-2026": "(حزقيال 37/ 1-14)",
    "24-05-2026": "(كورنثوس الأولى 12/ 1-11)",
    "25-05-2026": "(كورنثوس الأولى 6/ 12-20)",
    "26-05-2026": "(عبرانيين 12/ 1-13)",
    "27-05-2026": "(بطرس الأولى 1/ 3-12)",
    "28-05-2026": "(يوئيل 2/ 28-32)",
    "29-05-2026": "(بطرس الأولى 1/ 13-25)",
    "30-05-2026": "(رؤيا 3/ 14-22)",
    "31-05-2026": "(رؤيا 22/ 1-6)",

    # June
    "01-06-2026": "(جامعة 3/ 1-15)",
    "02-06-2026": "(أفسس 5/ 15-21)",
    "03-06-2026": "(يوحنا 4/ 43-54)",
    "04-06-2026": "(تكوين 1/ 1-31)",
    "05-06-2026": "(رومية 2/ 1-16)",
    "06-06-2026": "(مرقس 1/ 21-28)",
    "07-06-2026": "(كورنثوس الأولى 10/ 23-32)",
    "08-06-2026": "(كورنثوس الثانية 1/ 3-11)",
    "09-06-2026": "(متى 8/ 14-17)",
    "10-06-2026": "(أعمال 10/ 1-8)",
    "11-06-2026": "(غلاطية 1/ 6-10)",
    "12-06-2026": "(تيموثاوس الأولى 1/ 3-11)",
    "13-06-2026": "(عبرانيين 1/ 1-14)",
    "14-06-2026": "(تسالونيكي الأولى 1/ 2-10)",
    "15-06-2026": "(متى 13/ 1-23)",
    "16-06-2026": "(مزامير 90)",
    "17-06-2026": "(خروج 3/ 1-10)",
    "18-06-2026": "(خروج 3/ 11-17)",
    "19-06-2026": "(كورنثوس الأولى 11/ 17-34)",
    "20-06-2026": "(مرقس 4/ 35-41)",
    "21-06-2026": "(لوقا 20/ 9-19)",
    "22-06-2026": "(أفسس 1/ 3-14)",
    "23-06-2026": "(تسالونيكي الثانية 1/ 3-14)",
    "24-06-2026": "(تيموثاوس الثانية 1/ 1-4)",
    "25-06-2026": "(متى 24/ 45-51)",
    "26-06-2026": "(كولوسي 1/ 3-14)",
    "27-06-2026": "(يعقوب 1/ 1-18)",
    "28-06-2026": "(بطرس الأولى 1/ 3-12)",
    "29-06-2026": "(متى 9/ 27-34)",
    "30-06-2026": "(فيليبي 1/ 3-11)"
}

schedule_second_half = {
    # July
    "01-07-2026": "(متى 5/ 1-12)",
    "02-07-2026": "(رومية 12/ 9-21)",
    "03-07-2026": "(لوقا 4/ 31-37)",
    "04-07-2026": "(كولوسي 3/ 12-17)",
    "05-07-2026": "(مزامير 119/ 161-168)",
    "06-07-2026": "(متى 8/ 1-4)",
    "07-07-2026": "(أعمال 9/ 20-31)",
    "08-07-2026": "(كورنثوس الأولى 2/ 6-16)",
    "09-07-2026": "(لوقا 5/ 17-26)",
    "10-07-2026": "(لوقا 12/ 41-48)",
    "11-07-2026": "(عبرانيين 12/ 14-17)",
    "12-07-2026": "(كورنثوس الأولى 10/ 15-22)",
    "13-07-2026": "(أعمال 13/ 4-12)",
    "14-07-2026": "(كورنثوس الثانية 2/ 5-11)",
    "15-07-2026": "(مرقس 4/ 1-20)",
    "16-07-2026": "(مزامير 34)",
    "17-07-2026": "(يشوع 1/ 1-9)",
    "18-07-2026": "(يشوع 1/ 10-18)",
    "19-07-2026": "(متى 5/ 13-16)",
    "20-07-2026": "(لوقا 8/ 22-25)",
    "21-07-2026": "(مرقس 12/ 1-12)",
    "22-07-2026": "(أعمال 12/ 6-19)",
    "23-07-2026": "(رومية 5/ 1-11)",
    "24-07-2026": "(أفسس 2/ 11-22)",
    "25-07-2026": "(لوقا 12/ 35-40)",
    "26-07-2026": "(بطرس الأولى 2/ 1-3)",
    "27-07-2026": "(يوحنا الأولى 3/ 11-24)",
    "28-07-2026": "(يوحنا الأولى 4/ 7-21)",
    "29-07-2026": "(متى 14/ 13-21)",
    "30-07-2026": "(رومية 5/ 21)",
    "31-07-2026": "(رومية 6/ 1-14)",

    # August
    "01-08-2026": "(كورنثوس الأولى 13/ 1-13)",
    "02-08-2026": "(بطرس الأولى 3/ 8-22)",
    "03-08-2026": "(مرقس 1/ 29-34)",
    "04-08-2026": "(تكوين 11/ 1-9)",
    "05-08-2026": "(صموئيل الثاني 13/ 1-22)",
    "06-08-2026": "(متى 9/ 1-8)",
    "07-08-2026": "(صموئيل الأول 24/ 1-7)",
    "08-08-2026": "(صموئيل الأول 24/ 8-22)",
    "09-08-2026": "(لوقا 6/ 6-11)",
    "10-08-2026": "(لوقا 13/ 6-9)",
    "11-08-2026": "(تكوين 45/ 1-13)",
    "12-08-2026": "(متى 10/ 5-15)",
    "13-08-2026": "(أعمال 14/ 8-21)",
    "14-08-2026": "(تيطس 2/ 1-15)",
    "15-08-2026": "(لوقا 8/ 4-15)",
    "16-08-2026": "(مزامير 41)",
    "17-08-2026": "(قضاة 6/ 11-16)",
    "18-08-2026": "(قضاة 6/ 17-24)",
    "19-08-2026": "(تكوين 14/ 1-24)",
    "20-08-2026": "(مرقس 6/ 30-44)",
    "21-08-2026": "(متى 21/ 33-45)",
    "22-08-2026": "(خروج 14/ 15-31)",
    "23-08-2026": "(متى 7/ 7-12)",
    "24-08-2026": "(أعمال 17/ 16-34)",
    "25-08-2026": "(لوقا 12/ 13-21)",
    "26-08-2026": "(فيلبي 4/ 10-20)",
    "27-08-2026": "(تيموثاوس الأولى 5/ 1-16)",
    "28-08-2026": "(تيموثاوس الأولى 5/ 17-25)",
    "29-08-2026": "(متى 14/ 22-36)",
    "30-08-2026": "(يعقوب 2/ 1-13)",
    "31-08-2026": "(يعقوب 2/ 14-26)",

    # September
    "01-09-2026": "(لوقا 14/ 25-33)",
    "02-09-2026": "(مرقس 8/ 34-38)",
    "03-09-2026": "(مرقس 1/ 40-45)",
    "04-09-2026": "(كورنثوس الأولى 14/ 26-40)",
    "05-09-2026": "(مرقس 6/ 7-13)",
    "06-09-2026": "(متى 8/ 5-13)",
    "07-09-2026": "(تكوين 15/ 1-21)",
    "08-09-2026": "(صموئيل الأوى 8/ 1-22)",
    "09-09-2026": "(لوقا 7/ 11-17)",
    "10-09-2026": "(لوقا 14/ 15-24)",
    "11-09-2026": "(كورنثوس الثانية 4/ 1-18)",
    "12-09-2026": "(أعمال 15/ 1-12)",
    "13-09-2026": "(أعمال 15/ 13-29)",
    "14-09-2026": "(تكوين 22/ 1-19)",
    "15-09-2026": "(مرقس 4/ 21-25)",
    "16-09-2026": "(مزامير 119/ 97-104)",
    "17-09-2026": "(مزامير 119/ 105-112)",
    "18-09-2026": "(مزامير 119/ 129-136)",
    "19-09-2026": "(متى 7/ 13-14)",
    "20-09-2026": "(لوقا 9/ 10-17)",
    "21-09-2026": "(متى 21/ 33-45)",
    "22-09-2026": "(خروج 15/ 22-27)",
    "23-09-2026": "(خروج 16/ 1-36)",
    "24-09-2026": "(خروج 17/ 1-7)",
    "25-09-2026": "(متى 13/ 44-53)",
    "26-09-2026": "(تيموثاوس الأولى 6/ 3-10)",
    "27-09-2026": "(تكوين 32/ 22-32)",
    "28-09-2026": "(يعقوب 5/ 7-12)",
    "29-09-2026": "(مرقس 6/ 45-56)",
    "30-09-2026": "(بطرس الأولى 3/ 8-22)",

    # October
    "01-10-2026": "(تيموثاوس الأولى 1/ 12-20)",
    "02-10-2026": "(تيموثاوس الأولى 4/ 12-16)",
    "03-10-2026": "(لوقا 4/ 38-41)",
    "04-10-2026": "(صموئيل الأول 17/ 1-19)",
    "05-10-2026": "(صموئيل الأول 17/ 20-54)",
    "06-10-2026": "(مرقس 2/ 1-12)",
    "07-10-2026": "(تكوين 28/ 10-22)",
    "08-10-2026": "(لوقا 9/ 1-6)",
    "09-10-2026": "(متى 12/ 9-13)",
    "10-10-2026": "(لوقا 14/ 34-35)",
    "11-10-2026": "(يعقوب 3/ 1-12)",
    "12-10-2026": "(لوقا 14/ 1-14)",
    "13-10-2026": "(لوقا 11/ 33-36)",
    "14-10-2026": "(مرقس 3/ 20-27)",
    "15-10-2026": "(لوقا 8/ 16-18)",
    "16-10-2026": "(مزامير 27)",
    "17-10-2026": "(قضاة 13/ 1-7)",
    "18-10-2026": "(قضاة 13/ 8-25)",
    "19-10-2026": "(متى 7/ 15-20)",
    "20-10-2026": "(يوحنا 6/ 1-15)",
    "21-10-2026": "(متى 20/ 1-16)",
    "22-10-2026": "(تيموثاوس الثانية 1/ 1-7)",
    "23-10-2026": "(تيموثاوس الثانية 1/ 8-18)",
    "24-10-2026": "(لوقا 10/ 38-42)",
    "25-10-2026": "(لوقا 13/ 18-21)",
    "26-10-2026": "(متى 8/ 18-22)",
    "27-10-2026": "(مرقس 9/ 33-37)",
    "28-10-2026": "(متى 17/ 1-8)",
    "29-10-2026": "(يوحنا 6/ 16-24)",
    "30-10-2026": "(لوقا 7/ 36-50)",
    "31-10-2026": "(لوقا 12/ 1-12)",

    # November
    "01-11-2026": "(يوحنا 3/ 22-36)",
    "02-11-2026": "(يوحنا 5/ 31-47)",
    "03-11-2026": "(لوقا 5/ 12-16)",
    "04-11-2026": "(صموئيل الأول 20/ 1-16)",
    "05-11-2026": "(صموئيل الأوى 20/ 17-42)",
    "06-11-2026": "(مرقس 3/ 1-6)",
    "07-11-2026": "(أمثال 4/ 1-9)",
    "08-11-2026": "(يوحنا 14/ 1-14)",
    "09-11-2026": "(لوقا 7/ 1-10)",
    "10-11-2026": "(متى 18/ 10-14)",
    "11-11-2026": "(راعوث 1/ 1-22)",
    "12-11-2026": "(راعوث 2/ 1-23)",
    "13-11-2026": "(راعوث 3/ 1-18)",
    "14-11-2026": "(راعوث 4/ 1-22)",
    "15-11-2026": "(مرقس 4/ 26-29)",
    "16-11-2026": "(مزامير 15)",
    "17-11-2026": "(صموئيل الأول 16/ 1-13)",
    "18-11-2026": "(تكوين 27/ 1-40)",
    "19-11-2026": "(خروج 20/ 1-21)",
    "20-11-2026": "(متى 15/ 21-28)",
    "21-11-2026": "(لوقا 16/ 1-13)",
    "22-11-2026": "(مرقس 9/ 2-8)",
    "23-11-2026": "(يوحنا 1/ 35-42)",
    "24-11-2026": "(يوحنا 1/ 43-51)",
    "25-11-2026": "(مرقس 4/ 30-34)",
    "26-11-2026": "(يوحنا 9/ 1-12)",
    "27-11-2026": "(يوحنا 9/ 13-34)",
    "28-11-2026": "(يوحنا 9/ 35-41)",
    "29-11-2026": "(مرقس 8/ 22-26)",
    "30-11-2026": "(يوحنا 18/ 1-11)",

    # December
    "01-12-2026": "(تكوين 39/ 1-23)",
    "02-12-2026": "(كورنثوس الثانية 11/ 16-33)",
    "03-12-2026": "(متى 8/ 23-27)",
    "04-12-2026": "(لوقا 16/ 1-13)",
    "05-12-2026": "(تكوين 18/ 16-33)",
    "06-12-2026": "(يوحنا 6/ 16-24)",
    "07-12-2026": "(صموئيل الثاني 11/ 1-27)",
    "08-12-2026": "(صموئيل الثاني 12/ 1-15)",
    "09-12-2026": "(مرقس 7/ 31-37)",
    "10-12-2026": "(لوقا 15/ 1-7)",
    "11-12-2026": "(تثنية 5/ 6-21)",
    "12-12-2026": "(يعقوب 4/ 1-10)",
    "13-12-2026": "(أمثال 11/ 1-13)",
    "14-12-2026": "(لوقا 19/ 11-27)",
    "15-12-2026": "(متى 13/ 24-43)",
    "16-12-2026": "(مزامير 101)",
    "17-12-2026": "(صموئيل الأول 3/ 1-9)",
    "18-12-2026": "(صموئيل الأول 3/ 10-21)",
    "19-12-2026": "(تيموثاوس الثانية 3/ 1-9)",
    "20-12-2026": "(مرقس 7/ 24-30)",
    "21-12-2026": "(أمثال 28/ 18-28)",
    "22-12-2026": "(مزامير 31)",
    "23-12-2026": "(تيموثاوس الثانية 2/ 14-26)",
    "24-12-2026": "(متى 25/ 14-30)",
    "25-12-2026": "(لوقا 15/ 8-10)",
    "26-12-2026": "(لوقا 15/ 11-32)",
    "27-12-2026": "(متى 22/ 1-14)",
    "28-12-2026": "(متى 25/ 1-13)",
    "29-12-2026": "(لوقا 14/ 1-14)",
    "30-12-2026": "(متى 25/ 31-46)",
    "31-12-2026": "(مزامير 51)",

}

schedule = {**schedule, **schedule_second_half}




# -----------------------------
# 2. Mapping Arabic book codes to file prefixes
# -----------------------------
book_map = {
    "تكوين": "GEN", "خروج": "EXO", "لاوي": "LEV", "عدد": "NUM", "تثنية": "DEU",
    "يشوع": "JOS", "قضاة": "JDG", "راعوث": "RUT", "صموئيل الأول": "1SA", "صموئيل الثاني": "2SA",
    "ملوك الأول": "1KI", "ملوك الثاني": "2KI", "أخبار الأيام الأول": "1CH", "أخبار الأيام الثاني": "2CH",
    "عزرا": "EZR", "نحميا": "NEH", "أستير": "EST", "أيوب": "JOB", "مزامير": "PSA",
    "أمثال": "PRO", "جامعة": "ECC", "نشيد الأنشاد": "SNG", "إشعياء": "ISA", "إرميا": "JER",
    "مراثي": "LAM", "حزقيال": "EZK", "دانيال": "DAN", "هوشع": "HOS", "يوئيل": "JOL",
    "عاموس": "AMO", "عوبديا": "OBA", "يونان": "JON", "ميخا": "MIC", "ناحوم": "NAM",
    "حبقوق": "HAB", "صفنيا": "ZEP", "حجاي": "HAG", "زكريا": "ZEC", "ملاخي": "MAL",
    "متى": "MAT", "مرقس": "MRK", "لوقا": "LUK", "يوحنا": "JHN", "أعمال": "ACT",
    "رومية": "ROM", "كورنثوس الأولى": "1CO", "كورنثوس الثانية": "2CO", "غلاطية": "GAL", 
    "أفسس": "EPH", "فيلبي": "PHP", "كولوسي": "COL", "تسالونيكي الأولى": "1TH", 
    "تسالونيكي الثانية": "2TH", "تيموثاوس الأولى": "1TI", "تيموثاوس الثانية": "2TI", 
    "تيطس": "TIT", "فليمون": "PHM", "عبرانيين": "HEB", "يعقوب": "JAS", 
    "بطرس الأولى": "1PE", "بطرس الثانية": "2PE", "يوحنا الأولى": "1JN", 
    "يوحنا الثانية": "2JN", "يوحنا الثالثة": "3JN", "يهوذا": "JUD", "رؤيا": "REV",
    "لو": "LUK", "مت": "MAT", "مر": "MRK", "يو": "JHN", "أع": "ACT", "غلاطية": "GAL",
    "أفسس": "EPH", "فيليبي": "PHP", "كولوسي": "COL", "1بط": "1PE"
}

# -----------------------------
# 3. Function to extract verse range
# -----------------------------

def extract_verse_text(file_path, start_verse=None, end_verse=None):
    """
    Extracts verses from a JSON file for a single chapter.
    If start_verse and end_verse are None, returns the whole chapter.
    """
    with open(file_path, "r", encoding="utf-8") as f:
        data = json.load(f)
    verses = data["verses"]
    text_list = []

    if start_verse is None:
        # Whole chapter
        text_list = [v for k, v in sorted(verses.items(), key=lambda x: int(x[0]))]
    else:
        if end_verse is None:
            end_verse = max(int(k) for k in verses.keys())
        for v in range(start_verse, end_verse + 1):
            str_v = str(v)
            if str_v in verses:
                text_list.append(int_to_arabic(v)+" "+verses[str_v])
    return " ".join(text_list)+"\n"

def int_to_arabic(n):
    eng_to_ar = str.maketrans("0123456789", "٠١٢٣٤٥٦٧٨٩")
    return str(n).translate(eng_to_ar)

# -----------------------------
# 4. Function to parse address
# -----------------------------

def parse_address(address):
    """
    Parses an address like:
    (غلاطية 3/26-4/7), (لوقا 7/1-10), (لوقا 7/1), (لوقا 7)
    Returns a dict with book, start_chapter, start_verse, end_chapter, end_verse
    """
    addr = address.strip("()").strip()
    result = {
        "book": None,
        "start_chapter": None,
        "start_verse": None,
        "end_chapter": None,
        "end_verse": None
    }

    if "/" in addr:
        # Split book from the rest using the last occurrence of space before "/"
        book_part, rest = addr.split("/", 1)
        book_part = book_part.strip()
        # Handle case where book name has number (like 'تسالونيكي الأولى 3')
        if " " in book_part:
            parts = book_part.rsplit(" ", 1)
            if parts[1].isdigit():
                result["book"] = parts[0]  # only take book name
                rest = parts[1] + "/" + rest  # prepend chapter number back to rest
            else:
                result["book"] = book_part
        else:
            result["book"] = book_part

        rest = rest.strip()

        if "-" in rest:
            start_part, end_part = rest.split("-", 1)
            # Start
            if "/" in start_part:
                result["start_chapter"], result["start_verse"] = map(int, start_part.split("/"))
            else:
                result["start_chapter"] = int(start_part)
                result["start_verse"] = 1
            # End
            if "/" in end_part:
                result["end_chapter"], result["end_verse"] = map(int, end_part.split("/"))
            else:
                result["end_chapter"] = result["start_chapter"]
                result["end_verse"] = int(end_part)
        else:
            # Single verse or whole chapter
            if "/" in rest:
                result["start_chapter"], result["start_verse"] = map(int, rest.split("/"))
                result["end_chapter"], result["end_verse"] = result["start_chapter"], result["start_verse"]
            else:
                # Whole chapter
                result["start_chapter"] = result["end_chapter"] = int(rest)
                result["start_verse"] = result["end_verse"] = None
    else:
        # Only book (unlikely)
        # Split the string into book and chapter/verse if possible
        parts = re.split(r'(\d+)', addr, maxsplit=1)
        if len(parts) == 3:
            result["book"] = parts[0].strip()
            result["start_chapter"] = int(parts[1])
            result["end_chapter"] = int(parts[1])
        else:
            result["book"] = addr.strip()

    return result


# -----------------------------
# Build data.json
# -----------------------------

output = {}

for date, address in schedule.items():
    parsed = parse_address(address)
    book_code = book_map.get(parsed["book"])
    if not book_code:
        print(f"Unknown book: {parsed['book']}")
        continue

    # Loop through chapters if cross-chapter range
    chapter_range = range(parsed["start_chapter"], parsed["end_chapter"] + 1)
    chapter_texts = []

    for chapter in chapter_range:
        content = "الاصحاح " + int_to_arabic(chapter) + ":\n"
        json_file = f"bible/output/{book_code}_{chapter}.json"
        if not os.path.exists(json_file):
            print(f"File not found: {json_file}")
            continue

        # Determine verses to extract for this chapter
        if parsed["start_verse"] is None:
            # Whole chapter
            content += extract_verse_text(json_file)
        else:
            if chapter == parsed["start_chapter"] and chapter == parsed["end_chapter"]:
                content += extract_verse_text(json_file, parsed["start_verse"], parsed["end_verse"])
            elif chapter == parsed["start_chapter"]:
                content += extract_verse_text(json_file, parsed["start_verse"], None)
            elif chapter == parsed["end_chapter"]:
                content += extract_verse_text(json_file, 1, parsed["end_verse"])
            else:
                content += extract_verse_text(json_file, 1, None)
        chapter_texts.append(content)

    # Convert date format from dd-mm-yyyy to mm-dd-yyyy
    day, month, year = date.split("-")
    formatted_date = f"{month}-{day}-{year}"

    output[formatted_date] = [address, " ".join(chapter_texts)]
    print(f"Processed {formatted_date}: {address}")

# Save to data.json
with open("bible/data.json", "w", encoding="utf-8") as f:
    json.dump(output, f, ensure_ascii=False, indent=4)

print("✅ data.json created successfully.")
